<!DOCTYPE html>
<html lang="vi">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Lá»‹ch sá»­ Äáº·t Lá»‹ch KhÃ¡m Bá»‡nh</title>
	<link th:href="@{/css/lichsudatlichkham.css}" rel="stylesheet">
	<link th:href="@{/css/headerbenhnhan.css}" rel="stylesheet">
	<link th:href="@{/css/footerbenhnhan.css}" rel="stylesheet">
</head>

<body>
	<div th:replace="benhnhan/fragments/header :: header"></div>
	<div class="history-container">
		<h1>Lá»‹ch Sá»­ Äáº·t Lá»‹ch KhÃ¡m Bá»‡nh</h1>

		<!-- Bá»™ lá»c tÃ¬m kiáº¿m theo ngÃ y -->
		<div class="history-filter-container">
			<label for="date">NgÃ y:</label>
			<input type="date" id="date" name="date" th:value="${date}" />
			<button class="history-filter-btn" onclick="filterDate(event)">Lá»c</button>
		</div>

		<!-- Kiá»ƒm tra náº¿u khÃ´ng cÃ³ lá»‹ch sá»­ -->
		<div th:if="${#lists.isEmpty(slots)}" class="no-history-message">
			<p>KhÃ´ng cÃ³ lá»‹ch sá»­ Ä‘áº·t lá»‹ch khÃ¡m bá»‡nh!</p>
		</div>

		<!-- Báº£ng lá»‹ch sá»­ Ä‘áº·t lá»‹ch khÃ¡m bá»‡nh -->
		<table th:if="${!#lists.isEmpty(slots)}" class="history-table">
			<thead>
				<tr>
					<th>BÃ¡c SÄ©</th>
					<th>NgÃ y</th>
					<th>Giá»</th>
					<th>Tráº¡ng thÃ¡i</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="slot : ${slots}">
					<td>
						<span th:text="${slot.lichKhamBenh.bacSi.ten}">Dr. Nguyá»…n VÄƒn A</span>
						<form th:action="@{/chat/bacsi}" method="get" style="display:inline;">
							<input type="hidden" name="bacSiId" th:value="${slot.lichKhamBenh.bacSi.bacSiId}" />
							<button type="submit" class="history-chat-btn">ğŸ’¬Nháº¯n tin</button>
						</form>
					</td>

					<td th:text="${slot.lichKhamBenh.ngayThangNam}">10/12/2024</td>
					<td th:text="${slot.thoiGianBatDau}">08:00</td>
					<td>
						<div th:if="${slot.trangThai == 'pending'}">
							<form th:action="@{/user/cancel}" method="post" style="display:inline;">
								<input type="hidden" name="slotId" th:value="${slot.slotId}" />
								<input type="hidden" name="date" th:value="${date}" />
								<input type="hidden" name="page" th:value="${currentPage}" />
								<button type="submit" class="history-cancel-btn">Há»§y</button>
							</form>
						</div>
						<div th:unless="${slot.trangThai == 'pending'}" th:text="${slot.trangThai}">
							<!-- Slot status like 'confirmed', 'completed', etc. -->
						</div>
					</td>
				</tr>
			</tbody>
		</table>

		<!-- PhÃ¢n trang -->
		<div th:if="${!#lists.isEmpty(slots)}" class="history-pagination">
			<!-- Previous Button (only visible if not on the first page) -->
			<button th:if="${currentPage > 0}" th:data-page="${currentPage - 1}" onclick="navigatePage(event)">Â«
				TrÆ°á»›c</button>

			<span>Trang <span th:text="${currentPage + 1}"></span> / <span th:text="${totalPages}"></span></span>

			<!-- Next Button (only visible if not on the last page) -->
			<button th:if="${currentPage < totalPages - 1}" th:data-page="${currentPage + 1}"
				onclick="navigatePage(event)">Tiáº¿p Â»</button>
		</div>
	</div>
	<div th:replace="benhnhan/fragments/footer :: footer"></div>

	<script>
		function filterDate(event) {
			var date = document.getElementById('date').value;
			if (date) {
				window.location.href = '/user/lichsudatlich?date=' + date;
			} else {
				alert('Vui lÃ²ng chá»n ngÃ y!');
			}
		}

		function navigatePage(event) {
			var page = event.target.getAttribute('data-page');
			var totalPages = parseInt('${totalPages}', 10); // Total pages from Thymeleaf
			var date = document.getElementById('date').value || '${date}'; // Use default date if not selected

			// Ensure the page number is valid
			if (page < 0 || page >= totalPages) {
				return; // Do nothing if page is out of range
			}
			window.location.href = '/user/lichsudatlich?date=' + date + '&page=' + page;
		}
	</script>
</body>

</html>